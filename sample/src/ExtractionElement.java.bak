import com.fasterxml.jackson.databind.node.ObjectNode;
import com.fasterxml.jackson.databind.node.JsonNodeFactory;
import com.fasterxml.jackson.databind.ObjectMapper;
import com.fasterxml.jackson.databind.JsonNode;
import com.fasterxml.jackson.databind.node.ArrayNode;
import java.io.File;
import java.util.Map;
import java.util.Iterator;

class ExtractionElement {

  JsonNode paramName = null;
    
  void extractionJson() throws Exception {
    //ファイルの読み込み
    ObjectMapper mapper = new ObjectMapper();
    JsonNode root = mapper.readTree(new File("test.json"));

    //比較対象のJson
    JsonNode resJson = mapper.readTree(new File("resut.json"));
    System.out.println("resJson : " + resJson.toString());

    //分割対象のデータ
    paramName = mapper.readTree(new File("element.json"));
    System.out.println("paramName : " + paramName.toString());


    if(!paramName.isArray()){
      return ;
    }
    
    ArrayNode pathArray = (ArrayNode)paramName;
    int pathsize = pathArray.size();

    //OutPut用のArrayNode作成
    JsonNodeFactory factory = JsonNodeFactory.instance;
    ArrayNode arrayData = new ArrayNode(factory); 
    for (int count = 0; count < pathsize; count++){
      arrayData.add(new ArrayNode(factory));
    }
    System.out.println(getCondMatchJson(root, resJson, 0, arrayData));
    System.out.println(arrayData.toString());

  }

public int getCondMatchJson(JsonNode findJson, JsonNode resJson,  int currentdepth, ArrayNode array){
    int boolnum = 0;
    int sumboolnum = 0;
    boolean retbool = false;
    int nextdepth = currentdepth + 1;
    boolean nextpathbool = paramName.has(nextdepth);
    String paramString = paramName.get(currentdepth).asText();
    ArrayNode tmpArray = null;
    JsonNode tmpJson = null;

    if(paramString.equals("*")){
      Map.Entry<String,JsonNode> jsonmap = null;
      Iterator<Map.Entry<String,JsonNode>> jsonIte = findJson.fields();
      while (jsonIte.hasNext()) {
        jsonmap = jsonIte.next();
        if(nextpathbool){
          boolnum = getCondMatchJson(jsonmap.getValue(), resJson, nextdepth, array);
        } else {
          if(jsonmap.getValue().equals(resJson)) {
            boolnum = 1;
          }
        }
        for(int count = 0; count < boolnum; count++){
          tmpJson = array.get(currentdepth);
          if (tmpJson instanceof ArrayNode){
            tmpArray = (ArrayNode)tmpJson;
            tmpArray.add(jsonmap.getValue());
          }
        }
        sumboolnum = sumboolnum + boolnum;
      }
      System.out.println("paramString : " + paramString + " boolnum : " + boolnum);
      return sumboolnum;
    } else {
      if(nextpathbool){
        boolnum = getCondMatchJson(findJson.path(paramString), resJson, nextdepth, array);
      } else {
        if(findJson.path(paramString).equals(resJson)) {
          boolnum = 1;
        }
      }
      for(int count = 0; count < boolnum; count++){
        tmpJson = array.get(currentdepth);
        if (tmpJson instanceof ArrayNode){
          tmpArray = (ArrayNode)tmpJson;
          tmpArray.add(findJson.path(paramString));
        }
      }
      System.out.println("paramString : " + paramString + " boolnum : " + boolnum);
      return boolnum;
    }
}
}
