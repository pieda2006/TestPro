## 4.2 Service Operations

### 4.2.1 Introduction

### 4.2.2 Npcf_SMPolicyControl_Create Service Operation

#### 4.2.2.1 General

The Npcf_SMPolicyControl_Create service operation provides means for the SMF to request the creation of a corresponding SM Policy Association with PCF.
```
Npcf_SMPolicyControl_Createサービス操作は、SMFがPCFとの対応するSMポリシーアソシエーションの作成を要求する手段を提供します。
```
The Session Management procedures of the SMF and related to policies are defined in 3GPP TS 23.501 [2], 3GPP TS 23.502 [3] and 3GPP TS 23.503 [6].
```
SMFのセッション管理手順およびポリシーに関連するものは、3GPP TS 23.501 [2]、3GPP TS 23.502 [3]、および3GPP TS 23.503 [6]で定義されています。
```
The following procedures using the Npcf_SMPolicyControl_Create service operation are supported:
```
Npcf_SMPolicyControl_Createサービス操作を使用する次の手順がサポートされています。
```
- Request of creation of a corresponding SM Policy Association with PCF.
```
PCFとの対応するSMポリシーアソシエーションの作成の要求。
```
- Provisioning of PCC rules.
```
PCCルールのプロビジョニング。
```
- Provisioning of policy control request triggers.
```
ポリシー制御要求トリガーのプロビジョニング。    
```
- Provisioning of charging related information for PDU session.
```
PDUセッションの課金関連情報のプロビジョニング。
```
- Provisioning of revalidation time.
```
再検証時間のプロビジョニング。
```
- Policy provisioning and enforcement of authorized AMBR per PDU session.
```
PDUセッションごとの許可されたAMBRのポリシーのプロビジョニングと適用。
```
- Policy provisioning and enforcement of authorized default QoS.
```
認可されたデフォルトQoSのポリシーのプロビジョニングと実施。
```
- Provisioning of PCC rule for Application Detection and Control.
```
アプリケーションの検出と制御のためのPCCルールのプロビジョニング。
```
- 3GPP PS Data Off Support.
```
3GPP PSデータオフのサポート。
```
- IMS Emergency Session Support.
```
IMS緊急セッションのサポート。
```
- Request Usage Monitoring Control.
```
使用状況の監視制御を要求します。
```
- Access Network Charging Identifier report.
```
ネットワーク充電識別子レポートにアクセスします。
```
- Request for the successful resource allocation notification.
```
正常なリソース割り当て通知のリクエスト。
```
- Provisioning of IP Index Information.
```
IPインデックス情報のプロビジョニング。
```
- Negotiation of the QoS flow for IMS signalling.
```
IMSシグナリングのQoSフローのネゴシエーション。
```
- PCF resource cleanup.
```
PCFリソースのクリーンアップ。
```
- Access traffic steering, switching and splitting support.
```
アクセストラフィックのステアリング、スイッチング、および分割のサポート。
```
When the SMF receives the Nsmf_PDUSession_CreateSMContext Request as defined in subclause 5.2.2.2 of 3GPP TS 29.502 [22], if the SMF was requested not to interact with the PCF, the SMF shall not interact with the PCF;
```
SMFが3GPP TS 29.502 [22]の5.2.2.2節で定義されているNsmf_PDUSession_CreateSMContext Requestを受信した場合、SMFがPCFと対話しないように要求された場合、SMFはPCFと対話しません。
```
otherwise, the SMF shall send the POST method as step 1of the figure 4.2.2.2-1 to request to create an "Individual SM Policy".
```
そうでない場合、SMFは図4.2.2.2-1のステップ1としてPOSTメソッドを送信して、「個別SMポリシー」の作成を要求します。
```
NOTE 1: The decision to not interact with PCF applies for the life time of the PDU session.
```
注1：PCFと対話しないという決定は、PDUセッションの存続期間に適用されます。
```
NOTE 2: The indicator to not interact with PCF is configured in the UDM. 
```
注2：PCFと対話しないためのインジケーターは、UDMで構成されます。
```
It is delivered by the UDM to the SMF within the Charging Characteristics using the Session Management Subscription Data Retrieval service operation as described in 3GPP TS 29.503 [34]. 
```
これは、3GPP TS 29.503 [34]で説明されているセッション管理サブスクリプションデータ取得サービス操作を使用して、課金特性内でUDMによってSMFに配信されます。
```
The indicator is operator specific, therefore it can only be used in non-roaming and home routed roaming cases.
```
このインジケータはオペレータ固有であるため、非ローミングおよびホームルーティングローミングの場合にのみ使用できます。
```
The SMF shall include SmPolicyContextData data structure in the payload body of the HTTP POST to request a creation of representation of the "Individual SM Policy" resource. 
```
SMFは、「個別SMポリシー」リソースの表現の作成を要求するために、HTTP POSTのペイロード本文にSmPolicyContextDataデータ構造を含めるものとします。
```
The "Individual SM Policy" resource is created as described below.
```
「個別SMポリシー」リソースは、以下の説明に従って作成されます。
```
The SMF shall include (if available) in SmPolicyContextData data structure:
```
SMFは、SmPolicyContextDataデータ構造に（使用可能な場合）を含めるものとします。
```
- SUPI of the user within the "supi" attribute;
```
「supi」属性内のユーザーのSUPI。
```
- PDU Session Id within the "pduSessionId" attribute;
```
「pduSessionId」属性内のPDUセッションID。
```
- DNN within the "dnn" attribute;
```
「dnn」属性内のDNN。
```
- URL identifying the recipient of SM policies update notification within the "notificationUri" attribute;
```
「notificationUri」属性内のSMポリシー更新通知の受信者を識別するURL。
```
- PDU Session Type within the "pduSessionType" attribute;
```
「pduSessionType」属性内のPDUセッションタイプ。
```
- PEI within the "pei" attribute;
```
「pei」属性内のPEI。
```
- Internal Group Id(s) within the "InterGrpIds" attribute;
```
「InterGrpIds」属性内の内部グループID。
```
- type of access within the "accessType" attribute;
```
「accessType」属性内のアクセスのタイプ。
```
- type of the radio access technology within the "ratType" attribute;
```
「ratType」属性内の無線アクセス技術のタイプ。
```
- the UE Ipv4 address within the "ipv4Address" attribute and/or the UE Ipv6 prefix within the "ipv6AddressPrefix" attribute;
```
「ipv4Address」属性内のUE Ipv4アドレスおよび/または「ipv6AddressPrefix」属性内のUE Ipv6プレフィックス。
```
- the UE time zone information within "ueTimeZone" attribute;
```
「ueTimeZone」属性内のUEタイムゾーン情報。
```
- the UDM subscribed Session-AMBR or, if the "DN-Authorization" feature is supported, the DN-AAA authorized Session-AMBR within "subsSessAmbr" attribute;
```
UDMがサブスクライブしたSession-AMBR、または「DN許可」機能がサポートされている場合は、「subsSessAmbr」属性内のDN-AAA許可セッションAMBR。
```
NOTE 3: When both, the UDM subscribed Session-AMBR and the DN-AAA authorized Session-AMBR are available in the SMF, the SMF includes the DN-AAA authorized Session-AMBR.
```
注3：UDMがサブスクライブしたSession-AMBRとDN-AAA許可セッション-AMBRの両方がSMFで利用可能な場合、SMFにはDN-AAA許可セッション-AMBRが含まれます。
```
- if the "DN-Authorization" feature is supported, the DN-AAA authorization profile index within the "authProfIndex" attribute;
```
「DN許可」機能がサポートされている場合、「authProfIndex」属性内のDN-AAA許可プロファイルインデックス。
```
- subscribed Default QoS Information within "subsDefQos" attribute;
```
「subsDefQos」属性内のサブスクライブされたデフォルトQoS情報。
```
- the number of supported packet filters for signalled QoS rules within the "numOfPackFilter";
```
「numOfPackFilter」内のシグナリングされたQoSルールでサポートされるパケットフィルターの数。
```
- the online charging status within "online" attribute;
```
「オンライン」属性内のオンライン課金ステータス。    
```
- the offline charging status within "offline" attribute;
```
「オフライン」属性内のオフライン課金ステータス。
```
- the charging characteristics within "chargingCharacteristics" attribute;
```
「chargingCharacteristics」属性内の課金特性。
```
- access network charging identifier within the " accNetChId" attribute;
```
「accNetChId」属性内のアクセスネットワーク課金識別子。
```
- the address of the network entity performing charging within the "chargEntityAddr" attribute;
```
「chargEntityAddr」属性内で課金を実行するネットワークエンティティのアドレス。
```
- 3GPP PS data off status within the "3gppPsDataOffStatus" attribute;
```
「3gppPsDataOffStatus」属性内の3GPP PSデータオフステータス。
```
- indication of UE supporting reflective QoS within the "refQosIndication" attribute;
```
「refQosIndication」属性内の反射型QoSをサポートするUEの表示。
```
- user location information within the "userLocationInfo" attribute;
```
「userLocationInfo」属性内のユーザーの位置情報。
```
- the S-NSSAI corresponding to the network slice the PDU session is allocated within the "sliceInfo" attribute.
```
PDUセッションが「sliceInfo」属性内で割り当てられるネットワークスライスに対応するS-NSSAI。
```
- the QoS flow usage required of the default QoS flow within the "qosFlowUsage" attribute;
```
「qosFlowUsage」属性内のデフォルトのQoSフローに必要なQoSフローの使用。
```
- identifier of the serving network within the "servingNetwork" attribute;
```
「servingNetwork」属性内のサービングネットワークの識別子。
```
- serving network function identifier within the "servNfId" attribute; and
```
「servNfId」属性内のサービングネットワーク機能識別子。そして
```
- trace control and configuration parameters information encoded as "traceReq" attribute.
```
「traceReq」属性としてエンコードされたトレース制御および構成パラメーター情報。
```
The SMF may include in "SmPolicyContextData" data structure the IPv4 address domain identity within the "ipDomain" attribute.
```
SMFは、「SmPolicyContextData」データ構造に「ipDomain」属性内のIPv4アドレスドメインIDを含めることができます。
```
NOTE 4: The "ipDomain" attribute is helpful when within a network slice instance, there are several separate IP address domains, with SMF/UPF(s) that allocate Ipv4 IP addresses out of the same private address range to UE PDU Sessions. 
```
注4：「ipDomain」属性は、ネットワークスライスインスタンス内に、同じプライベートアドレス範囲外のIpv4 IPアドレスをUE PDUセッションに割り当てるSMF / UPFを持つ複数の個別のIPアドレスドメインがある場合に役立ちます。
```
The same IP address can thus be allocated to UE PDU sessions served by SMF/UPFs in different IPv4 address domains. 
```
したがって、異なるIPv4アドレスドメイン内のSMF / UPFによって処理されるUE PDUセッションに同じIPアドレスを割り当てることができます。
```
If one PCF controls several SMF/UPFs in different IP address domains, the UE IP address is thus not sufficient for the AF session binding procedure, as described in 3GPP TS 29.514 [17]. 
```
1つのPCFが異なるIPアドレスドメインで複数のSMF / UPFを制御する場合、3GPP TS 29.514 [17]で説明されているように、UE IPアドレスはAFセッションバインディング手順には不十分です。
```
The SMF assits the PCF in the session binding supplying an "ipDomain" attribute denoting the IPv4 address domain identity of the allocated UE IPv4 address.
```
SMFは、割り当てられたUE IPv4アドレスのIPv4アドレスドメインIDを示す「ipDomain」属性を提供するセッションバインディングでPCFを支援します。
```
When the PCF receives the HTTP POST request from the SMF, the PCF shall make an authorization based on the information received from the SMF and, if available, AMF, CHF, AF, UDR, NWDAF and operator policy pre-configured at the PCF. 
```
PCFがSMFからHTTP POST要求を受信すると、PCFはSMFから受信した情報に基づいて承認を行い、可能であれば、AMF、CHF、AF、UDR、NWDAF、およびPCFで事前に構成されたオペレーターポリシーを実行します。
```
If the authorization is successful, the PCF shall create a new resource, which represents "Individual SM Policy", addressed by a URI as defined in subclause 5.3.3.2 and contains a PCF created resource identifier. 
```
認可が成功した場合、PCFは、5.3.3.2節で定義されたURIでアドレス指定され、PCFで作成されたリソース識別子を含む「個別SMポリシー」を表す新しいリソースを作成します。
```
The PCF shall respond to the SMF with a 201 Created message, including:
```
PCFは、以下を含む201 CreatedメッセージでSMFに応答します。
```
- Location header field containing the URI for the created resource; and
```
作成されたリソースのURIを含む場所ヘッダーフィールド。 そして
```
- a response body providing session management related policies, e.g. provisioning of PCC rules as defined in subclause 4.2.6.2, provisioning of policy control request triggers as defined in subclause 4.2.6.4.
```
セッション管理に関連するポリシーを提供する応答本文。 4.2.6.2節で定義されているPCCルールのプロビジョニング、4.2.6.4節で定義されているポリシー制御要求トリガーのプロビジョニング。
```
The SMF shall use the URI received in the Location header in subsequent requests to the PCF to refer to the "Individual SM Policy".
```
SMFは、PCFへの後続の要求でLocationヘッダーで受信したURIを使用して、「個々のSMポリシー」を参照するものとします。
```
It the PCF received a "traceReq" attribute, it shall perform trace procedures as defined in 3GPP TS 32.422 [24].
```
PCFが「traceReq」属性を受信した場合、3GPP TS 32.422 [24]で定義されているトレース手順を実行します。
```
If errors occur when processing the HTTP POST request, the PCF shall apply error handling procedures as specified in subclause 5.7.
```
HTTP POST要求の処理中にエラーが発生した場合、PCFは、5.7節で指定されているエラー処理手順を適用するものとします。
```
If the user information received within the "supi" attribute is unknown, the PCF shall reject the request and include in an HTTP "400 Bad Request" response message the "cause" attribute of the ProblemDetails data structure set to "USER_UNKNOWN".
```
「supi」属性内で受信したユーザー情報が不明な場合、PCFは要求を拒否し、HTTP「400 Bad Request」応答メッセージに「USER_UNKNOWN」に設定されたProblemDetailsデータ構造の「cause」属性を含めます。
```
If the PCF is, due to incomplete, erroneous or missing information (e.g. QoS, RAT type, subscriber information) not able to provision a policy decision as response to the request for PCC rules by the SMF, the PCF may reject the request and include in an HTTP "400 Bad Request" response message the "cause" attribute of the ProblemDetails data structure set to "ERROR_INITIAL_PARAMETERS".
```
PCFが、SMFによるPCCルールの要求への応答としてポリシー決定をプロビジョニングできない、不完全な、誤った、または欠落している情報（QoS、RATタイプ、加入者情報など）により、PCFは要求を拒否し、 HTTP「400 Bad Request」応答メッセージでは、ProblemDetailsデータ構造の「cause」属性が「ERROR_INITIAL_PARAMETERS」に設定されています。
```
If the PCF, based on local configuration and/or operator policies, denies the creation of the Individual SM Policy resource, the PCF may reject the request and include in an HTTP "403 Forbidden" response message the "cause" attribute of the ProblemDetails data structure set to "POLICY_CONTEXT_DENIED". 
```
PCFが、ローカル構成および/またはオペレーターポリシーに基づいて、個々のSMポリシーリソースの作成を拒否した場合、PCFは要求を拒否し、HTTP「403 Forbidden」応答メッセージにProblemDetailsデータの「cause」属性を含めることができます 「POLICY_CONTEXT_DENIED」に設定された構造。
```
Based on configured failure action, the SMF at reception of this error code may reject the PDU session establishment or allow the PDU session establishment applying local policies.
```
設定された障害アクションに基づいて、このエラーコードを受信したSMFは、PDUセッションの確立を拒否するか、ローカルポリシーを適用するPDUセッションの確立を許可します。
```
If the SMF receives HTTP response with these codes, the SMF shall reject the PDU session establishment that initiated the HTTP POST Request.
```
SMFがこれらのコードを含むHTTP応答を受信した場合、SMFはHTTP POST要求を開始したPDUセッションの確立を拒否します。
```
#### 4.2.2.4 Provisioning of revalidation time
The PCF may within the SmPolicyDecision data structure provide the revalidation time within the "revalidationTime" attribute and the RE_TIMEOUT policy control request trigger within the "policyCtrlReqTriggers" attribute to instruct the SMF to trigger a PCF interaction to request PCC rule from the PCF.
```
SmPolicyDecisionデータ構造内のPCFは、「revalidationTime」属性内の再検証時間と「policyCtrlReqTriggers」属性内のRE_TIMEOUTポリシー制御要求トリガーを提供し、PCFからPCCルールを要求するPCF相互作用をトリガーするようにSMFに指示できます。
```
The SMF shall start the timer based on the revalidation time and shall send the PCC rule request before the indicated revalidation time.
```
SMFは、再検証時間に基づいてタイマーを開始し、示された再検証時間の前にPCCルール要求を送信するものとします。
```
4.2.2.5 Policy provisioning and enforcement of authorized AMBR per PDU session 
The SMF may include either the UDM subscribed AMBR or, if the "DN-Authorization" feature is supported, the DN-AAA authorized AMBR per PDU session with the "subsSessAmbr" attribute within the SmPolicyContextData data structure as defined in subclause 4.2.2.2. 
```
SMFには、UDMサブスクライブAMBRが含まれている場合があります。「DN許可」機能がサポートされている場合、4.2.2.2節で定義されているSmPolicyContextDataデータ構造内の「subsSessAmbr」属性を持つPDUセッションごとのDN-AAA許可AMBRが含まれる場合があります。
```
When both, the UDM subscribed Session-AMBR and the DN-AAA authorized Session-AMBR are available in the SMF, the DN-AAA authorized Session-AMBR shall take precedence over the UDM subscribed Session-AMBR.
```
UDMがサブスクライブしたSession-AMBRとDN-AAAが許可したSession-AMBRの両方がSMFで利用可能な場合、DN-AAAが許可したSession-AMBRがUDMがサブスクライブしたSession-AMBRよりも優先されます。
```
The PCF shall authorize the session AMBR based on the operator's policy and provision the authorized session AMBR to the SMF in the response of the message as defined in subclause 4.2.6.3.1 and 4.2.6.3.2.
```
PCFは、オペレーターのポリシーに基づいてセッションAMBRを承認し、4.2.6.3.1節と4.2.6.3.2節で定義されているように、メッセージの応答で承認されたセッションAMBRをSMFにプロビジョニングします。
```
Upon receiving the authorized session AMBR from the PCF, the SMF shall apply the corresponding procedures towards the access network, the UE and the UPF for the enforcement of the AMBR per PDU session.
```
許可セッションAMBRをPCFから受信すると、SMFは、PDUセッションごとにAMBRを実施するために、対応する手順をアクセスネットワーク、UE、およびUPFに適用します。
```

#### 4.2.2.6 Policy provisioning and enforcement of authorized default QoS

During the PDU session establishment as defined in subclause 4.2.2.2, the SMF may include the subscribed default QoS with the "subsDefQos" attribute. The PCF shall provision the authorized default QoS to the SMF in the response of the message as defined in subclause 4.2.6.3.1 and 4.2.6.3.2.
```
4.2.2.2節で定義されているPDUセッションの確立中に、SMFは「subsDefQos」属性を持つサブスクライブされたデフォルトQoSを含めることができます。 PCFは、4.2.6.3.1節および4.2.6.3.2節で定義されているように、メッセージの応答で許可されたデフォルトQoSをSMFにプロビジョニングするものとします。
```
Upon receiving the authorized default QoS, the SMF enforces it which may lead to the change of the subscribed default QoS. 
```
許可されたデフォルトQoSを受信すると、SMFはそれを実施し、サブスクライブされたデフォルトQoSの変更につながる可能性があります。
```
The SMF shall apply the corresponding procedures towards the access network, the UE and the UPF for the enforcement of the authorized default QoS.
```
SMFは、承認されたデフォルトQoSの実施のために、対応する手順をアクセスネットワーク、UE、およびUPFに適用します。
```
NOTE 1: If dynamic PCC is not deployed, the SMF can have a DNN based configuration to enable the establishment of a GBR resource type default QoS flow. 
```
注1：動的PCCが展開されていない場合、SMFはDNNベースの構成を使用して、GBRリソースタイプのデフォルトQoSフローを確立できます。
```
This configuration contains a standardized GBR 5QI as well as GFBR and MFBR for UL and DL.
```
この構成には、標準化されたGBR 5QIと、ULおよびDL用のGFBRおよびMFBRが含まれています。
```
NOTE 2: GBR resource type is not applicable to the default QoS flow of the PDU session which is interworking with EPS.
```
注2：GBRリソースタイプは、EPSと相互作用しているPDUセッションのデフォルトのQoSフローには適用されません。
```

#### 4.2.2.7 Provisioning of PCC rule for Application Detection and Control

If the ADC feature is supported, and the user subscription indicates that the application detection and control is required, the PCF may provision PCC rule for application detection and control as defined in subclause 4.2.6.2.11 in the response message.
```
ADC機能がサポートされており、アプリケーションの検出と制御が必要であることがユーザーサブスクリプションに示されている場合、PCFは、応答メッセージの4.2.6.2.11節で定義されているアプリケーションの検出と制御用のPCCルールをプロビジョニングできます。
```
If the SMF receives the PCC rule for application detection and control, the SMF shall instruct the UPF as defined in 3GPP TS 29.244 [13] to detect the application traffic.
```
SMFがアプリケーションの検出と制御のためのPCCルールを受信した場合、SMFは3GPP TS 29.244 [13]で定義されているようにUPFにアプリケーショントラフィックを検出するよう指示するものとします。
```

#### 4.2.2.16 PCF resource cleanup

In the Npcf_SMPolicyControl_Create service operation, the SMF as NF service consumer may provide SMF Id in "smfId" attribute and recovery timestamp in "recoveryTime" attribute. 
```
Npcf_SMPolicyControl_Createサービス操作では、NFサービスコンシューマとしてのSMFは、「smfId」属性でSMF IDを提供し、「recoveryTime」属性で回復タイムスタンプを提供します。
```
The PCF may use the "smfId" attribute to supervise the status of the SMF as described in subclause 5.2 of 3GPP TS 29.510 [29] and perform necessary cleanup upon status change of the SMF later, and/or both the "smfId" attribute and the "recoveryTime" attribute in cleanup procedure as described in subclause 6.4 of 3GPP TS 23.527 [33].
```
PCFは、「smfId」属性を使用して、3GPP TS 29.510 [29]の5.2節で説明されているように、SMFのステータスを監視できます。そして3GPP TS 23.527 [33]の6.4節で説明されているように、後のSMFのステータス変更、および/またはクリーンアップ手順の「smfId」属性と「recoveryTime」属性の両方で必要なクリーンアップを実行します。
```

# 確認事項
| 通番 | 確認内容 | 確認結果 |
|---|---|---|
| 1 | 3GPP PS Data は何の機能のことなのか。 |---|
|---|---|---|
|---|---|---|
